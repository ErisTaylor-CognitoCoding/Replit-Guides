Quick SSO Setup for Curriculum Creator
Task: Implement SSO login from DashDeck
Users will arrive from https://cognitocoding.dashdeck.app with a ?code= parameter. We need to exchange this code for authentication.

Implementation Steps
1. Add Backend SSO Login Endpoint
Create /api/sso/login that exchanges the authorization code:

app.post("/api/sso/login", async (req, res) => {
  const { code } = req.body;
  
  try {
    // Exchange code with DashDeck
    const response = await fetch("https://cognitocoding.dashdeck.app/api/sso/exchange", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code })
    });
    
    if (!response.ok) {
      return res.status(401).json({ error: "Invalid authorization code" });
    }
    
    const { token, user, establishment } = await response.json();
    
    // Store in session
    req.session.ssoToken = token;
    req.session.userId = user.id;
    req.session.user = user;
    req.session.establishment = establishment;
    
    res.json({ success: true, user, establishment });
  } catch (error) {
    console.error("SSO login error:", error);
    res.status(500).json({ error: "SSO login failed" });
  }
});

2. Handle Code on App Load (Frontend)
Detect the authorization code when users land and exchange it:

// On app initialization
const urlParams = new URLSearchParams(window.location.search);
const authCode = urlParams.get('code');
if (authCode) {
  // Exchange code for authentication
  const response = await fetch("/api/sso/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code: authCode })
  });
  
  if (response.ok) {
    const { user, establishment } = await response.json();
    
    // Apply establishment branding
    if (establishment.colorScheme?.primary) {
      document.documentElement.style.setProperty('--primary', establishment.colorScheme.primary);
    }
    if (establishment.colorScheme?.accent) {
      document.documentElement.style.setProperty('--accent', establishment.colorScheme.accent);
    }
    
    // Clean URL and reload
    window.history.replaceState({}, document.title, "/");
    window.location.reload();
  } else {
    // Show error or redirect to login
    console.error("SSO authentication failed");
  }
}

3. Protect Routes with Auth Middleware
async function requireAuth(req: any, res: any, next: any) {
  if (!req.session.ssoToken) {
    return res.status(401).json({ error: "Not authenticated" });
  }
  next();
}
// Use on protected routes
app.get("/api/curricula", requireAuth, async (req, res) => {
  // Your route logic
});

What You'll Receive from DashDeck
User Object:

{
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  profileImageUrl: string;
  role: "teacher" | "admin" | "super_admin";
}

Establishment Object:

{
  id: string;
  name: string;
  logoUrl: string;
  colorScheme: {
    primary: string;    // e.g., "210 100% 50%"
    accent: string;
  }
}

Key Points
✅ Authorization codes are one-time use and expire in 60 seconds
✅ JWT tokens expire in 15 minutes
✅ Exchange must happen server-side (never in browser)
✅ Apply establishment branding colors to your UI
✅ Store user session after successful exchange
Testing
Go to https://cognitocoding.dashdeck.app
Log in as a user
Click "Curriculum Creator" app
Should redirect to your app with ?code=...
Your app should auto-login the user
That's it! Users will seamlessly log in from DashDeck to your app.
